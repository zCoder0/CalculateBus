<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Speedometer (GPS + Simulated)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to right, #141e30, #243b55);
            color: white;
            text-align: center;
            padding-top: 100px;
        }
        h1 {
            font-size: 48px;
        }
        #speed {
            font-size: 80px;
            color: #00ffcc;
            font-weight: bold;
        }
        #status {
            font-size: 20px;
            color: #ffcc00;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Speedometer</h1>
    <div id="speed">0 km/h</div>
    <div id="status">Initializing...</div>

    <script>
        const speedDisplay = document.getElementById('speed');
        const statusDisplay = document.getElementById('status');

        let useSimulated = false;
        let simulatedSpeed = 0;
        let direction = 1;

        // Convert meters/second to km/h
        function toKmph(mps) {
            return mps * 3.6;
        }

        // Show speed on screen
        function displaySpeed(kmph) {
            speedDisplay.textContent = `${kmph.toFixed(1)} km/h`;
        }

        // Simulated speed function
        function startSimulatedSpeed() {
            statusDisplay.textContent = "Using simulated speed (GPS unavailable)";
            setInterval(() => {
                if (direction === 1) {
                    simulatedSpeed += Math.random() * 2;
                    if (simulatedSpeed >= 80) direction = -1;
                } else {
                    simulatedSpeed -= Math.random() * 2;
                    if (simulatedSpeed <= 0) direction = 1;
                }
                displaySpeed(simulatedSpeed);
            }, 1000);
        }

        // Real GPS speed callback
        function handleGPS(position) {
            const gpsSpeed = position.coords.speed;
            if (gpsSpeed === null || gpsSpeed === 0) {
                if (!useSimulated) {
                    useSimulated = true;
                    startSimulatedSpeed();
                }
            } else {
                useSimulated = false;
                const kmph = toKmph(gpsSpeed);
                displaySpeed(kmph);
                statusDisplay.textContent = "Using GPS speed";
            }
        }

        // Error callback
        function handleGPSError(error) {
            if (!useSimulated) {
                useSimulated = true;
                startSimulatedSpeed();
            }
        }

        // Try to get real GPS data
        if ('geolocation' in navigator) {
            navigator.geolocation.watchPosition(handleGPS, handleGPSError, {
                enableHighAccuracy: true,
                maximumAge: 1000,
                timeout: 5000
            });
        } else {
            statusDisplay.textContent = "Geolocation not supported. Using simulation.";
            useSimulated = true;
            startSimulatedSpeed();
        }
    </script>
</body>
</html>
